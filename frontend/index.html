<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TheNextChapter | Basketball Shot Logger</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
    <style>
        /* General Setup */
        :root {
            /* LIGHT MODE COLORS (DEFAULT) */
            --primary-blue: #3A478F; 
            --light-blue: #6A7BC5; 
            --background-light: #F7F7F7; 
            --card-background: #FFFFFF;
            --text-dark: #1F2937; 
            --text-muted: #6B7280; 
            --border-color: #E5E7EB; 
            --button-text: #FFFFFF;
            --table-header-bg: #F3F4F6; 
            --accent-green: #38A169; /* For positive percentages */
            --accent-red: #E53E3E;   /* For shot chart */
            --shot-chart-bg: #1A202C; /* Dark background for chart contrast */

            /* DARK MODE COLORS */
            --dark-background-color: #111827; 
            --dark-card-color: #1F2937; 
            --dark-text-color: #F9FAFB; 
            --dark-text-muted: #9CA3AF; 
            --dark-border-color: #374151; 
            --dark-table-header-bg: #374151;
        }
        
        /* DARK MODE STYLES */
        body.dark-mode {
            background-color: var(--dark-background-color);
            color: var(--dark-text-color);
        }

        body.dark-mode .section,
        body.dark-mode header,
        body.dark-mode nav,
        body.dark-mode .stat-card {
            background-color: var(--dark-card-color);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.5);
        }
        
        body.dark-mode .stat-card {
            border: 1px solid var(--dark-border-color);
        }

        body.dark-mode h2,
        body.dark-mode h1,
        body.dark-mode nav a.active {
            color: var(--light-blue);
        }

        body.dark-mode .tagline,
        body.dark-mode nav a,
        body.dark-mode .text-muted,
        body.dark-mode td {
            color: var(--dark-text-muted) !important;
        }

        body.dark-mode nav a.active {
            border-bottom-color: var(--light-blue) !important;
        }
        
        body.dark-mode th {
            background-color: var(--dark-table-header-bg);
            color: var(--light-blue) !important; 
        }

        body.dark-mode th,
        body.dark-mode td {
            border-bottom: 1px solid var(--dark-border-color);
        }

        body.dark-mode .cta-button, 
        body.dark-mode .action-button,
        body.dark-mode .auth-button {
            background-color: var(--primary-blue);
            color: var(--button-text);
        }

        body.dark-mode input[type="text"] {
            background-color: var(--dark-card-color) !important; 
            color: var(--dark-text-color) !important;
            border-color: var(--dark-border-color) !important;
        }
        
        /* BASE STYLES - NBA Stats Aesthetic */
        body {
            font-family: 'Inter', sans-serif;
            margin: 0;
            padding: 0;
            background-color: var(--background-light);
            color: var(--text-dark);
            line-height: 1.6;
            transition: background-color 0.3s, color 0.3s;
        }

        .container {
            max-width: 1200px; 
            margin: 0 auto;
            padding: 20px;
        }
        
        /* Header & Toggle/Auth Buttons */
        header {
            text-align: center;
            padding: 40px 0 20px 0;
            margin-bottom: 0; 
            background-color: var(--card-background);
            border-radius: 0; 
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            position: relative;
        }

        #header-controls {
            position: absolute;
            top: 15px;
            right: 25px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        #mode-toggle {
            background: none;
            border: none;
            color: var(--primary-blue);
            cursor: pointer;
            font-size: 1.5em;
            transition: color 0.2s;
        }
        
        .auth-button {
            padding: 8px 15px;
            font-size: 0.9em;
            font-weight: 600;
            border-radius: 20px;
            border: none;
            cursor: pointer;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .auth-button:hover {
            background-color: var(--light-blue); 
            transform: translateY(-1px);
        }

        h1 {
            color: var(--primary-blue); 
            font-size: 3.5em; 
            margin-bottom: 0;
            font-weight: 900;
            letter-spacing: 2px;
        }

        .tagline {
            color: var(--text-muted);
            font-size: 1em;
            font-weight: 500;
            margin-top: 5px;
        }

        /* Navigation Bar */
        nav {
            display: flex;
            justify-content: center;
            margin-bottom: 20px;
            background-color: var(--card-background);
            border-radius: 0;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.05);
            padding: 10px 0;
            border-bottom: 1px solid var(--border-color);
        }

        nav a {
            padding: 10px 20px;
            color: var(--text-muted);
            text-decoration: none;
            border-bottom: 3px solid transparent;
            margin: 0 15px;
            font-weight: 600;
            font-size: 1.05em;
        }

        nav a:hover, nav a.active {
            color: var(--primary-blue); 
            border-bottom-color: var(--primary-blue); 
        }

        /* Section Styling */
        .section {
            background-color: var(--card-background);
            padding: 30px 40px; 
            border-radius: 10px; 
            margin-bottom: 20px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            transition: background-color 0.3s, box-shadow 0.3s;
        }
        
        /* Initial State: Only Stats is visible */
        #stats { display: block; } 
        #profiles { display: none; }
        #player-profile-detail { display: none; } 

        /* Table Styling */
        table {
            width: 100%;
            border-collapse: collapse;
            text-align: right; 
            font-size: 0.95em;
            margin-top: 10px;
        }

        th {
            text-align: left; 
            font-weight: 700;
            letter-spacing: 0.5px;
            text-transform: uppercase;
            padding: 12px 10px;
            background-color: var(--table-header-bg);
            border-bottom: 2px solid var(--border-color);
            color: var(--text-dark);
        }
        
        td {
            padding: 12px 10px;
            border-bottom: 1px solid var(--border-color);
        }

        th:first-child, td:first-child {
            text-align: left;
        }

        tr:hover {
            background-color: rgba(58, 71, 143, 0.05);
        }
        
        .player-name-link {
            cursor: pointer;
            color: var(--primary-blue) !important;
            text-decoration: underline;
            transition: color 0.2s;
        }
        .player-name-link:hover {
            color: var(--light-blue) !important;
        }

        body.dark-mode tr:hover {
            background-color: rgba(106, 123, 197, 0.1); 
        }
        
        /* Profile Detail Styling */
        .profile-header {
            display: flex;
            align-items: center;
            gap: 20px;
            padding-bottom: 20px;
            margin-bottom: 20px;
            border-bottom: 1px solid var(--border-color);
        }
        
        body.dark-mode .profile-header {
             border-bottom-color: var(--dark-border-color);
        }

        .profile-header h2 {
            margin: 0;
            padding: 0;
            border: none;
        }

        .stat-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .stat-card {
            padding: 15px;
            border-radius: 8px;
            background-color: var(--background-light);
            border: 1px solid var(--border-color);
            text-align: center;
        }
        
        .stat-label {
            font-size: 0.8em;
            color: var(--text-muted);
            text-transform: uppercase;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .stat-value {
            font-size: 2em;
            font-weight: 800;
            color: var(--text-dark);
            line-height: 1;
        }
        
        .stat-value.percentage {
            color: var(--accent-green);
        }
        
        /* Shot Chart Placeholder Styling (Court Visual) */
        .shot-chart-container {
            margin-top: 40px;
            padding: 20px;
            background-color: var(--shot-chart-bg);
            border-radius: 10px;
            position: relative;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
            aspect-ratio: 1 / 1; /* Approximate court aspect ratio */
        }
        
        .shot-chart-title {
            color: var(--dark-text-color);
            text-align: center;
            margin-bottom: 15px;
            font-weight: 600;
            font-size: 1.2em;
        }
        
        .court-markings {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 90%;
            height: 90%;
            border: 2px solid #D1D5DB; /* Light grey court line */
            border-radius: 5px;
            display: flex;
            justify-content: center;
            align-items: flex-end;
            overflow: hidden;
        }
        
        .three-point-line {
            position: absolute;
            bottom: -50%; /* Make it a semi-circle from the bottom edge */
            width: 250%; 
            height: 250%;
            border: 2px solid #D1D5DB;
            border-radius: 50%;
            clip: rect(0, 100%, 100%, 0); /* Clip to just the bottom semicircle */
            transform: translateY(125%);
            box-sizing: border-box;
        }

        .key-area {
            width: 15%;
            height: 35%;
            border: 2px solid #D1D5DB;
            border-bottom: none;
            position: absolute;
            bottom: 0;
        }
        
        .shot-data-placeholder {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: rgba(255, 255, 255, 0.4);
            font-size: 1.5em;
            font-weight: 700;
            text-shadow: 1px 1px 2px #000;
            z-index: 10;
        }

        /* Back Button */
        .back-button {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            margin-bottom: 20px;
            background: none;
            border: none;
            color: var(--primary-blue);
            cursor: pointer;
            font-size: 1em;
            font-weight: 600;
            transition: color 0.2s;
        }

        .back-button:hover {
            color: var(--light-blue);
        }
        
        .back-button svg {
            width: 20px;
            height: 20px;
            fill: var(--primary-blue);
        }
        
        body.dark-mode .back-button svg {
            fill: var(--light-blue);
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            .section {
                padding: 20px;
            }
            h1 {
                font-size: 2.5em;
            }
            nav a {
                padding: 8px 10px;
                margin: 0 5px;
                font-size: 0.9em;
            }
        }
    </style>
</head>
<body>
    <header>
        <div id="header-controls">
            <button id="sign-in-button" class="auth-button">Sign In</button>
            <button id="mode-toggle" aria-label="Toggle Dark Mode">
                ‚òÄÔ∏è
            </button>
        </div>
        <h1>TheNextChapter</h1>
        <p class="tagline">Basketball Shot Logger</p>
    </header>

    <div class="container">
        
        <nav id="main-nav">
            <a href="#stats" class="active">üìä Overall Stats</a>
            <a href="#profiles" class="hidden-nav-link">üë§ Player Management</a> 
        </nav>

        <!-- STATS SECTION: PUBLIC TABLE VIEW -->
        <div id="stats" class="section">
            <h2>üìä Overall Player Statistics</h2>
            
            <p class="tagline" style="color: var(--text-muted); margin-bottom: 15px;">Filter performance data across all tracked games. Click on a player's name for detailed profile.</p>
            
            <div style="margin-bottom: 15px;">
                <input type="text" id="player-search" placeholder="Search player name..." 
                       style="width: 100%; padding: 12px; border: 1px solid var(--border-color); 
                              border-radius: 8px; box-sizing: border-box; font-size: 1em;
                              background-color: var(--card-background); color: var(--text-dark);">
            </div>
            
            <div style="overflow-x: auto;">
                <table id="stats-table"> 
                    <thead>
                        <tr>
                            <th>Player</th>
                            <th>GP</th>
                            <th>PTS</th>
                            <th>FG%</th>
                            <th>3P%</th>
                            <th>FT%</th>
                            <th>AST</th>
                            <th>REB</th>
                            <th>BLK</th>
                            <th>STL</th>
                        </tr>
                    </thead>
                    <tbody id="stats-table-body">
                        <!-- Data will be inserted here by JavaScript -->
                    </tbody>
                </table>
            </div>
        </div>
        
        <!-- PLAYER PROFILE DETAIL SECTION: HIDDEN, SHOWN ON NAME CLICK -->
        <div id="player-profile-detail" class="section">
            <button class="back-button" onclick="goToStatsList()">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"/></svg>
                Back to Stats List
            </button>
            
            <div class="profile-header">
                <svg xmlns="http://www.w3.org/2000/svg" width="60" height="60" fill="var(--light-blue)" viewBox="0 0 24 24">
                    <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>
                </svg>
                <div>
                    <h2 id="profile-player-name">Player Name</h2>
                    <p class="tagline" id="profile-tagline"></p>
                </div>
            </div>

            <h3>Season Averages</h3>
            <div class="stat-grid" id="detail-stat-grid">
                <!-- Stat cards will be injected here -->
            </div>
            
            <h3>Shot Chart Heatmap Placeholder</h3>
            <div class="shot-chart-container">
                <div class="shot-chart-title">Shot Frequency vs. League Average</div>
                <div class="court-markings">
                    <div class="three-point-line"></div>
                    <div class="key-area"></div>
                </div>
                <div class="shot-data-placeholder">
                    HEATMAP DATA GOES HERE
                    <p style="font-size: 0.5em; font-weight: 400; margin-top: 10px;">(Visualisation using D3 or Canvas)</p>
                </div>
            </div>
        </div>


        <!-- PLAYER MANAGEMENT SECTION: HIDDEN UNTIL SIGNED IN -->
        <div id="profiles" class="section hidden-section">
            <h2>üë§ Player Management & History</h2>
            <p class="tagline" style="color: var(--text-muted);">Manage profiles, view game history, and player-specific stats.</p>
            
            <nav id="profile-sub-nav" style="justify-content: flex-start; background: none; box-shadow: none; padding: 0 0 10px 0; border-bottom: 1px solid var(--border-color);">
                <a href="#player-manager" class="active" style="border-bottom-width: 2px;">+ Manage Players</a>
                <a href="#game-history" style="border-bottom-width: 2px;">üìÖ Game History</a>
            </nav>

            <div id="player-manager">
                <div style="text-align: center; padding: 20px;">
                    <svg xmlns="http://www.w3.org/2000/svg" width="50" height="50" fill="var(--light-blue)" viewBox="0 0 24 24">
                        <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>
                    </svg>
                    <p class="text-muted" style="margin-top: 10px;">
                        Use this section to add, edit, or delete player profiles.
                    </p>
                    <button class="action-button add-player-button">+ Add Player</button>
                    <button class="action-button cta-button" style="margin-left: 15px;">üöÄ Log New Game</button>
                </div>
            </div>

            <div id="game-history" style="display: none;">
                <h3 style="color: var(--primary-blue); border-bottom: 1px solid var(--border-color); padding-bottom: 10px;">History for Player: Azul</h3>
                <p class="text-muted">This area would list past games for the selected player, linking to detailed box scores.</p>
                <div style="overflow-x: auto;">
                    <table id="game-history-table">
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Opponent</th>
                                <th>Result</th>
                                <th style="text-align: right;">PTS</th>
                                <th style="text-align: right;">FG%</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>10/31/2024</td>
                                <td>Practice</td>
                                <td>N/A</td>
                                <td>0</td>
                                <td>0.0%</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <footer style="text-align: center; padding: 20px; color: var(--text-muted); font-size: 0.8em; margin-top: 20px;">
        TheNextChapter &copy; 2025 | Public Stats Portal
    </footer>

    <script>
        // --- DATA SECTION: EASILY REMOVABLE DUMMY DATA ---
        
        /* * TO REMOVE DUMMY DATA: 
        * 1. Replace the entire 'playerData' array with your actual data source (e.g., an API call or a database query).
        * 2. Remove the 'renderStatsTable()' call at the end of the script, 
        * or modify it to process your new data structure.
        */
        const playerData = [
            { player: 'Azul', gp: 12, pts: 25.4, fg_pct: 48.7, p3_pct: 38.1, ft_pct: 88.5, ast: 6.2, reb: 4.1, blk: 0.5, stl: 1.8 },
            { player: 'Rhea Sky', gp: 10, pts: 18.9, fg_pct: 44.2, p3_pct: 32.5, ft_pct: 80.0, ast: 4.5, reb: 3.8, blk: 0.2, stl: 1.1 },
            { player: 'Jasper Stone', gp: 15, pts: 8.5, fg_pct: 55.1, p3_pct: 25.0, ft_pct: 75.2, ast: 1.0, reb: 9.3, blk: 1.4, stl: 0.4 },
            { player: 'Nova Light', gp: 11, pts: 15.0, fg_pct: 40.5, p3_pct: 41.3, ft_pct: 90.1, ast: 7.1, reb: 2.5, blk: 0.1, stl: 2.0 },
            { player: 'Ethan King', gp: 14, pts: 5.2, fg_pct: 60.0, p3_pct: 0.0, ft_pct: 65.0, ast: 0.8, reb: 10.5, blk: 2.5, stl: 0.3 },
            { player: 'Chloe Green', gp: 9, pts: 22.1, fg_pct: 46.5, p3_pct: 35.5, ft_pct: 85.0, ast: 5.5, reb: 5.5, blk: 0.7, stl: 1.5 }
        ];

        // Define the stats structure for the detail grid
        const detailStatsMap = {
            pts: { label: 'Points', formatter: (val) => val.toFixed(1) },
            fg_pct: { label: 'FG%', formatter: (val) => val.toFixed(1) + '%' },
            p3_pct: { label: '3P%', formatter: (val) => val.toFixed(1) + '%' },
            ft_pct: { label: 'FT%', formatter: (val) => val.toFixed(1) + '%' },
            ast: { label: 'Assists', formatter: (val) => val.toFixed(1) },
            reb: { label: 'Rebounds', formatter: (val) => val.toFixed(1) },
            blk: { label: 'Blocks', formatter: (val) => val.toFixed(1) },
            stl: { label: 'Steals', formatter: (val) => val.toFixed(1) },
        };

        // --- DOM Elements ---
        const toggleButton = document.getElementById('mode-toggle');
        const body = document.body;
        const signInButton = document.getElementById('sign-in-button');
        const mainNav = document.getElementById('main-nav');
        const hiddenNavLinks = document.querySelectorAll('.hidden-nav-link');
        const hiddenSections = document.querySelectorAll('.hidden-section'); 
        
        const statsSection = document.getElementById('stats');
        const profileDetailSection = document.getElementById('player-profile-detail');
        const statsTableBody = document.getElementById('stats-table-body');
        const searchInput = document.getElementById('player-search');
        const statsTable = document.getElementById('stats-table');
        const detailStatGrid = document.getElementById('detail-stat-grid');


        // --- 0. NAVIGATION & VISIBILITY CONTROL ---
        
        // Function to transition back to the main stats list
        window.goToStatsList = function() {
            statsSection.style.display = 'block';
            profileDetailSection.style.display = 'none';
            document.getElementById('profiles').style.display = 'none';

            // Reset main navigation active state to Stats
            mainNav.querySelectorAll('a').forEach(a => a.classList.remove('active'));
            mainNav.querySelector('a[href="#stats"]').classList.add('active');
        }
        
        // Function to display the player profile detail view
        function displayPlayerProfile(player) {
            // 1. Hide all main sections
            statsSection.style.display = 'none';
            document.getElementById('profiles').style.display = 'none'; 

            // 2. Show the profile detail section
            profileDetailSection.style.display = 'block';

            // 3. Populate header
            document.getElementById('profile-player-name').textContent = player.player;
            document.getElementById('profile-tagline').textContent = `Tracked Games: ${player.gp}`;

            // 4. Populate stat cards
            detailStatGrid.innerHTML = '';
            
            Object.keys(detailStatsMap).forEach(key => {
                const statInfo = detailStatsMap[key];
                const value = player[key];
                
                const card = document.createElement('div');
                card.className = 'stat-card';
                
                // Determine if the stat is a percentage for styling
                const valueClass = key.includes('_pct') ? 'stat-value percentage' : 'stat-value';
                
                card.innerHTML = `
                    <div class="stat-label">${statInfo.label}</div>
                    <div class="${valueClass}">${statInfo.formatter(value)}</div>
                `;
                detailStatGrid.appendChild(card);
            });
            
            // 5. Update main navigation (no active tab when on a detail page)
            mainNav.querySelectorAll('a').forEach(a => a.classList.remove('active'));
        }

        // --- 1. DATA RENDERING FUNCTION ---
        function renderStatsTable() {
            if (!statsTableBody) return;
            statsTableBody.innerHTML = ''; // Clear existing content
            
            playerData.forEach(player => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="player-name-link" style="font-weight: bold;">${player.player}</td>
                    <td>${player.gp}</td>
                    <td>${player.pts.toFixed(1)}</td>
                    <td>${player.fg_pct.toFixed(1)}%</td>
                    <td>${player.p3_pct.toFixed(1)}%</td>
                    <td>${player.ft_pct.toFixed(1)}%</td>
                    <td>${player.ast.toFixed(1)}</td>
                    <td>${player.reb.toFixed(1)}</td>
                    <td>${player.blk.toFixed(1)}</td>
                    <td>${player.stl.toFixed(1)}</td>
                `;
                statsTableBody.appendChild(row);

                // Add click listener to the player name cell
                row.querySelector('.player-name-link').addEventListener('click', (e) => {
                    displayPlayerProfile(player);
                });
            });
        }


        // --- 2. DARK MODE TOGGLE SCRIPT (Unchanged) ---
        const toggleIcon = '‚òÄÔ∏è'; 
        const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
        const savedMode = localStorage.getItem('theme');

        if (savedMode === 'dark' || (savedMode === null && prefersDark)) {
            body.classList.add('dark-mode');
            toggleButton.innerHTML = 'üåô'; 
        } else {
            toggleButton.innerHTML = toggleIcon;
        }

        toggleButton.addEventListener('click', () => {
            if (body.classList.contains('dark-mode')) {
                body.classList.remove('dark-mode');
                localStorage.setItem('theme', 'light');
                toggleButton.innerHTML = toggleIcon;
            } else {
                body.classList.add('dark-mode');
                localStorage.setItem('theme', 'dark');
                toggleButton.innerHTML = 'üåô';
            }
        });


        // --- 3. SIGN-IN SIMULATION (REVISED LOGIC for Public Stats) ---
        const SIGNED_IN_KEY = 'tnc_signed_in';
        
        function updateUIState() {
            const isSignedIn = localStorage.getItem(SIGNED_IN_KEY) === 'true';
            
            if (isSignedIn) {
                hiddenNavLinks.forEach(link => link.style.display = 'inline-block');
                signInButton.textContent = 'Sign Out';
            } else {
                hiddenNavLinks.forEach(link => link.style.display = 'none');
                hiddenSections.forEach(section => section.style.display = 'none'); 
                signInButton.textContent = 'Sign In';

                // Ensure Stats is the active section when logging out
                goToStatsList();
            }
        }

        const handleSignInOut = () => {
            const isSignedIn = localStorage.getItem(SIGNED_IN_KEY) === 'true';
            if (isSignedIn) {
                localStorage.removeItem(SIGNED_IN_KEY); // Sign out
            } else {
                localStorage.setItem(SIGNED_IN_KEY, 'true'); // Sign in
            }
            updateUIState();
        };

        signInButton.addEventListener('click', handleSignInOut);
        
        // --- 4. PLAYER SEARCH FUNCTIONALITY ---
        if (searchInput && statsTable) {
            searchInput.addEventListener('keyup', function() {
                const filter = searchInput.value.toUpperCase();
                const tr = statsTable.getElementsByTagName('tbody')[0].getElementsByTagName('tr'); 

                for (let i = 0; i < tr.length; i++) {
                    const td = tr[i].getElementsByTagName('td')[0]; // Target the Player Name column
                    if (td) {
                        const txtValue = td.textContent || td.innerText;
                        if (txtValue.toUpperCase().indexOf(filter) > -1) {
                            tr[i].style.display = "";
                        } else {
                            tr[i].style.display = "none";
                        }
                    }
                }
            });
        }

        // --- 5. PROFILE SUB-NAVIGATION (for logged-in section) ---
        const profileSubNav = document.getElementById('profile-sub-nav');
        const playerManagerDiv = document.getElementById('player-manager');
        const gameHistoryDiv = document.getElementById('game-history');
        const managePlayersLink = profileSubNav ? profileSubNav.querySelector('a[href="#player-manager"]') : null;


        if (profileSubNav) {
             profileSubNav.querySelectorAll('a').forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    const targetId = this.getAttribute('href').substring(1);

                    profileSubNav.querySelectorAll('a').forEach(a => a.classList.remove('active'));
                    this.classList.add('active');

                    if (playerManagerDiv) playerManagerDiv.style.display = 'none';
                    if (gameHistoryDiv) gameHistoryDiv.style.display = 'none';

                    document.getElementById(targetId).style.display = 'block';
                });
            });

            if (managePlayersLink) managePlayersLink.click(); 
        }

        // --- 6. Main Navigation Logic ---
        mainNav.querySelectorAll('a').forEach(link => {
            link.addEventListener('click', function(e) {
                e.preventDefault(); 

                // Only handle navigation if not already on the detailed profile page
                if (profileDetailSection.style.display === 'block') {
                    // Clicking a main nav link should return to the list view first
                    if (this.getAttribute('href') === '#stats') {
                        goToStatsList();
                        return;
                    }
                }


                // Deactivate all main links
                mainNav.querySelectorAll('a').forEach(a => a.classList.remove('active'));
                this.classList.add('active');

                // Hide all switchable sections
                document.getElementById('stats').style.display = 'none';
                document.getElementById('profiles').style.display = 'none';
                profileDetailSection.style.display = 'none';


                // Show the target section (if not hidden by auth state)
                const targetId = this.getAttribute('href').substring(1);
                const targetElement = document.getElementById(targetId);
                
                if (targetElement) {
                   targetElement.style.display = 'block';
                }
            });
        });
        
        // --- INITIALIZATION ---
        renderStatsTable(); // Render player data on load
        updateUIState(); // Set initial sign-in state
    </script>
</body>
</html>
